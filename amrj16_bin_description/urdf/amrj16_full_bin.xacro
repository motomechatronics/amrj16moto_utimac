<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="full_bin">

    <!-- Definizione della variabile prefix -->
    <xacro:property name="prefix" value="full_bin"/>

    <!-- Link e giunti con prefix -->
    <link name="${prefix}_base_footprint">
    </link>

    <link name="${prefix}_base_link">
    </link>

    <joint name="${prefix}_base_link_base_footprintjoint" type="fixed">
        <origin rpy="0 0 0" xyz="0 0 0.103" />  
        <parent link="${prefix}_base_footprint" />
        <child link="${prefix}_base_link" />
    </joint>

    <!-- chassis -->
    <link name="${prefix}_chassis">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://amrj16_bin_description/models/meshes/utimac_bin_v1.dae"/>        
            </geometry>     
        </visual>
        <collision>
            <origin xyz="0 0 0.2" rpy="0 0 0"/>
            <geometry>               
                <box size="0.815 0.690 0.293" />         
            </geometry>
        </collision>
        <inertial>
            <mass value="38"/>
            <origin  xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="8.1" ixy="0.00213" ixz="4.56" iyy="11.5" iyz="-0.00156" izz="7.71"/>           
        </inertial>
    </link>

    <joint name="${prefix}_base_link_joint" type="fixed">
        <origin rpy="0 0 0" xyz="0 0 0" />  
        <parent link="${prefix}_base_link" />
        <child link="${prefix}_chassis" />
    </joint>

    <!-- front-right caster hub -->
    <link name="${prefix}_front_right_caster_hub">            
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://amrj16_bin_description/models/meshes/utimac_caster_bin_v1.dae"/>
            </geometry>
        </visual>

        <!--collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://amrj16_bin_description/models/meshes/utimac_caster_bin_v1.dae"/>
            </geometry>
        </collision -->   

        <inertial>
            <mass value="1"/>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <inertia ixx="0.0008063" ixy="0.00000393" ixz="-0.00000650" iyy="0.000693" iyz="0.000265" izz="0.0005498"/>            
        </inertial> 
    </link>
    
    <joint name="${prefix}_chassis_front_right_caster_hub_joint" type="continuous">
       <origin xyz="0.2925 0.215 0" rpy="0 0 0"/>
        <parent link="${prefix}_chassis"/>
        <child link="${prefix}_front_right_caster_hub"/>
        <axis xyz="0 0 1"/>
              <dynamics damping="0.5" friction="0.1"/>
    </joint>


 <!-- front-right caster wheel -->

            <link name="${prefix}_front_right_caster_wheel">            
        <visual>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
                <geometry>
                    <mesh filename="package://amrj16_bin_description/models/meshes/utimac_wheel_bin_v1.dae"/>
                </geometry>
        </visual>

    <collision>
        <origin xyz="0 0 0" rpy="1.57  0 0"/>
        <geometry>
                <cylinder radius="0.04" length="0.02"/>
        </geometry>
    </collision>   

    <inertial>
        <mass value="1"/>
        <origin rpy="0 0 0" xyz="1.57  0 0"/>
        <inertia 
            ixx="0.0003265" ixy="0" ixz="0" iyy="0.0003265" iyz="0" izz="0.0005849"/>            
    </inertial> 

    </link>

    <gazebo reference="${prefix}_front_right_caster_wheel">
      <collision>
        <surface>
          <friction>
            <ode>
              <mu>0.3</mu>
              <mu2>0.3</mu2>
            </ode>
            <bullet>
              <friction>0.3</friction>
              <friction2>0.3</friction2>
              <rolling_friction>0.1</rolling_friction>
            </bullet>
          </friction>
        </surface>
      </collision>
    </gazebo>    


    <joint name="${prefix}_front_right_caster_hub_wheel_joint" type="continuous">
       <origin xyz="0.039 0 -0.067" rpy="0 0 0"/>
        <parent link="${prefix}_front_right_caster_hub"/>
        <child link="${prefix}_front_right_caster_wheel"/>
        <axis xyz="0 1 0"/>
        <dynamics damping="0.5" friction="1.5"/>
    </joint>

 <!-- front-left caster hub -->
    <link name="${prefix}_front_left_caster_hub">            
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://amrj16_bin_description/models/meshes/utimac_caster_bin_v1.dae"/>
            </geometry>
        </visual>
        <!--collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://amrj16_bin_description/models/meshes/utimac_caster_bin_v1.dae"/>
            </geometry>
        </collision -->   
        <inertial>
            <mass value="1"/>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <inertia ixx="0.0008063" ixy="0.00000393" ixz="-0.00000650" iyy="0.000693" iyz="0.000265" izz="0.0005498"/>            
        </inertial> 
    </link>
    
    <joint name="${prefix}_chassis_front_left_caster_hub_joint" type="continuous">
       <origin xyz="0.2925 -0.215 0" rpy="0 0 0"/>
        <parent link="${prefix}_chassis"/>
        <child link="${prefix}_front_left_caster_hub"/>
        <axis xyz="0 0 1"/>
        <dynamics damping="0.5" friction="0.1"/>
    </joint>

<!-- front-left caster wheel -->

            <link name="${prefix}_front_left_caster_wheel">            
        <visual>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
                <geometry>
                    <mesh filename="package://amrj16_bin_description/models/meshes/utimac_wheel_bin_v1.dae"/>
                </geometry>
        </visual>

    <collision>
        <origin xyz="0 0 0" rpy="1.57  0 0"/>
        <geometry>
                <cylinder radius="0.04" length="0.02"/>
        </geometry>
    </collision>   

    <inertial>
        <mass value="1"/>
        <origin rpy="0 0 0" xyz="1.57  0 0"/>
        <inertia 
            ixx="0.0003265" ixy="0" ixz="0" iyy="0.0003265" iyz="0" izz="0.0005849"/>            
    </inertial> 

    </link>

    <gazebo reference="${prefix}_front_left_caster_wheel">
      <collision>
        <surface>
          <friction>
            <ode>
              <mu>0.3</mu>
              <mu2>0.3</mu2>
            </ode>
            <bullet>
              <friction>0.3</friction>
              <friction2>0.3</friction2>
              <rolling_friction>0.1</rolling_friction>
            </bullet>
          </friction>
        </surface>
      </collision>
    </gazebo> 


    <joint name="${prefix}_front_left_caster_hub_wheel_joint" type="continuous">
       <origin xyz="0.039 0 -0.067" rpy="0 0 0"/>
        <parent link="${prefix}_front_left_caster_hub"/>
        <child link="${prefix}_front_left_caster_wheel"/>
        <axis xyz="0 1 0"/>       
        <dynamics damping="0.5" friction="1.5"/>
    </joint>

  <!-- rear-right caster hub -->
    <link name="${prefix}_rear_right_caster_hub">            
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://amrj16_bin_description/models/meshes/utimac_caster_bin_v1.dae"/>
            </geometry>
        </visual>
        <!--collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://amrj16_bin_description/models/meshes/utimac_caster_bin_v1.dae"/>
            </geometry>
        </collision -->   
        <inertial>
            <mass value="1"/>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <inertia ixx="0.0008063" ixy="0.00000393" ixz="-0.00000650" iyy="0.000693" iyz="0.000265" izz="0.0005498"/>            
        </inertial> 
    </link>
    
    <joint name="${prefix}_chassis_rear_right_caster_hub_joint" type="continuous">
       <origin xyz="-0.2925 0.215 0" rpy="0 0 0"/>
        <parent link="${prefix}_chassis"/>
        <child link="${prefix}_rear_right_caster_hub"/>
        <axis xyz="0 0 1"/>      
        <dynamics damping="0.5" friction="0.1"/>
    </joint>


 <!-- rear-right caster wheel -->

            <link name="${prefix}_rear_right_caster_wheel">            
        <visual>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
                <geometry>
                    <mesh filename="package://amrj16_bin_description/models/meshes/utimac_wheel_bin_v1.dae"/>
                </geometry>
        </visual>

    <collision>
        <origin xyz="0 0 0" rpy="1.57  0 0"/>
        <geometry>
                <cylinder radius="0.04" length="0.02"/>
        </geometry>
    </collision>   

    <inertial>
        <mass value="1"/>
        <origin rpy="0 0 0" xyz="1.57  0 0"/>
        <inertia 
            ixx="0.0003265" ixy="0" ixz="0" iyy="0.0003265" iyz="0" izz="0.0005849"/>            
    </inertial> 

    </link>

   <gazebo reference="${prefix}_rear_right_caster_wheel">
      <collision>
        <surface>
          <friction>
            <ode>
              <mu>0.3</mu>
              <mu2>0.3</mu2>
            </ode>
            <bullet>
              <friction>0.3</friction>
              <friction2>0.3</friction2>
              <rolling_friction>0.1</rolling_friction>
            </bullet>
          </friction>
        </surface>
      </collision>
    </gazebo>

    <joint name="${prefix}_rear_right_caster_hub_wheel_joint" type="continuous">
       <origin xyz="0.039 0 -0.067" rpy="0 0 0"/>
        <parent link="${prefix}_rear_right_caster_hub"/>
        <child link="${prefix}_rear_right_caster_wheel"/>
        <axis xyz="0 1 0"/>       
        <dynamics damping="0.5" friction="1.5"/>
    </joint>

<!-- rear-left caster hub -->
    <link name="${prefix}_rear_left_caster_hub">            
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://amrj16_bin_description/models/meshes/utimac_caster_bin_v1.dae"/>
            </geometry>
        </visual>
        <!--collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://amrj16_bin_description/models/meshes/utimac_caster_bin_v1.dae"/>
            </geometry>
        </collision -->   
        <inertial>
            <mass value="1"/>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <inertia ixx="0.0008063" ixy="0.00000393" ixz="-0.00000650" iyy="0.000693" iyz="0.000265" izz="0.0005498"/>            
        </inertial> 
    </link>
    
    <joint name="${prefix}_chassis_rear_left_caster_hub_joint" type="continuous">
       <origin xyz="-0.2925 -0.215 0" rpy="0 0 0"/>
        <parent link="${prefix}_chassis"/>
        <child link="${prefix}_rear_left_caster_hub"/>
        <axis xyz="0 0 1"/>        
        <dynamics damping="0.5" friction="0.1"/>
    </joint>

<!-- rear-left caster wheel -->

            <link name="${prefix}_rear_left_caster_wheel">            
        <visual>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
                <geometry>
                    <mesh filename="package://amrj16_bin_description/models/meshes/utimac_wheel_bin_v1.dae"/>
                </geometry>
        </visual>

    <collision>
        <origin xyz="0 0 0" rpy="1.57  0 0"/>
        <geometry>
                <cylinder radius="0.04" length="0.02"/>
        </geometry>
    </collision>   

    <inertial>
        <mass value="1"/>
        <origin rpy="0 0 0" xyz="1.57  0 0"/>
        <inertia 
            ixx="0.0003265" ixy="0" ixz="0" iyy="0.0003265" iyz="0" izz="0.0005849"/>            
    </inertial> 

    </link>

    <gazebo reference="${prefix}_rear_left_caster_wheel">
      <collision>
        <surface>
          <friction>
            <ode>
              <mu>0.3</mu>
              <mu2>0.3</mu2>
            </ode>
            <bullet>
              <friction>0.3</friction>
              <friction2>0.3</friction2>
              <rolling_friction>0.1</rolling_friction>
            </bullet>
          </friction>
        </surface>
      </collision>
    </gazebo>

    <joint name="${prefix}_rear_left_caster_hub_wheel_joint" type="continuous">
       <origin xyz="0.039 0 -0.067" rpy="0 0 0"/>
        <parent link="${prefix}_rear_left_caster_hub"/>
        <child link="${prefix}_rear_left_caster_wheel"/>
        <axis xyz="0 1 0"/>        
        <dynamics damping="0.5" friction="1.5"/>
    </joint>


    <!-- Plugin Gazebo -->
    <gazebo>
      <plugin name="${prefix}_joint_state" filename="libgazebo_ros_joint_state_publisher.so">
        <ros>
          <!-- add the namespace to the ROS topic -->
          <namespace>${prefix}</namespace>  
          <remapping>~/out:=joint_states</remapping>
        </ros>
        <update_rate>30</update_rate>

        <!-- Joint prefix -->
        <joint_name>${prefix}_chassis_front_right_caster_hub_joint</joint_name>
        <joint_name>${prefix}_front_right_caster_hub_wheel_joint</joint_name>

        <joint_name>${prefix}_chassis_front_left_caster_hub_joint</joint_name>
        <joint_name>${prefix}_front_left_caster_hub_wheel_joint</joint_name>

        <joint_name>${prefix}_chassis_rear_right_caster_hub_joint</joint_name>
        <joint_name>${prefix}_rear_right_caster_hub_wheel_joint</joint_name>

        <joint_name>${prefix}_chassis_rear_left_caster_hub_joint</joint_name>
        <joint_name>${prefix}_rear_left_caster_hub_wheel_joint</joint_name>
    
      </plugin>
    </gazebo>

</robot>

